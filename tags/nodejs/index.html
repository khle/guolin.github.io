<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Tag: nodejs | GuoLin&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="GuoLin's blog">
<meta property="og:url" content="http://guolinn.com/tags/nodejs/">
<meta property="og:site_name" content="GuoLin's blog">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="GuoLin's blog">
<meta name="twitter:description">

  
    <link rel="alternative" href="/atom.xml" title="GuoLin&#39;s blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">

  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">GuoLin&#39;s blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><input type="submit" value="&#xF002;" class="search-form-submit"><input type="hidden" name="q" value="site:http://guolinn.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Getting-started-with-Fig-and-Express-js" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/02/17/Getting-started-with-Fig-and-Express-js/" class="article-date">
  <time datetime="2015-02-17T08:01:31.000Z" itemprop="datePublished">Feb 17 2015</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/02/17/Getting-started-with-Fig-and-Express-js/">Getting started with Fig and Express.js</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Let’s use Fig to set up and run a Expressjs/MongoDB app. Before starting, you’ll need to have <strong>Fig</strong> installed.</p>
<p>Let’s set up the <strong>four</strong> files that’ll get us started. </p>
<p>First, our app is going to be running inside a Docker container which contains all of its dependencies. We can define what goes inside that Docker container using a file called <code>Dockerfile</code>. It’ll contain this to start with:</p>
<pre><code>FROM dockerfile/nodejs

WORKDIR /data  
<span class="comment"># update to the latest</span>
RUN apt-get install gcc make build-essential

<span class="comment"># Add this to your Dockerfile, after your deps, but before your app code.</span>
<span class="comment"># The purpose of copy to /tmp folder firest is let docker cache the build result. </span>
<span class="comment"># The second time all the step will be cached.</span>

ADD package.json /tmp/package.json  
RUN cd /tmp &amp;amp;&amp;amp; <span class="built_in">npm</span> install  
RUN cp -a <span class="regexp">/tmp/node_modules /data/</span>
`<span class="javascript">&lt;<span class="regexp">/pre&gt;

That'll install our application inside an image with Nodejs installed alongside all of our Nodejs dependencies. For more information on how to write </span></span>`Dockerfiles`<span class="javascript">, see the [Docker user guide](https:<span class="comment">//docs.docker.com/userguide/dockerimages/#building-an-image-from-a-dockerfile) and the [Dockerfile reference](http://docs.docker.com/reference/builder/).</span>

Second, we define the dependencies <span class="keyword">in</span> a file called </span>`package.json`<span class="javascript">:

<span class="xml"><span class="tag">&lt;<span class="title">pre</span>&gt;</span></span></span>`{
  <span class="string">"name"</span>: <span class="string">"fig-nodejs"</span>,
  <span class="string">"description"</span>: <span class="string">"Getting started with Fig and Nodejs"</span>,
  <span class="string">"version"</span>: <span class="string">"0.0.1"</span>,
  <span class="string">"author"</span>: <span class="string">"Guolin"</span>,
  <span class="string">"engines"</span>: {
    <span class="string">"node"</span>: <span class="string">"0.10.x"</span>,
    <span class="string">"npm"</span>: <span class="string">"1.4.x"</span>
  },
  <span class="string">"dependencies"</span>: {
    <span class="string">"express"</span>: <span class="string">"~4.10.1"</span>,
    <span class="string">"mongoose"</span>: <span class="string">"~3.8.8"</span>
  }
}
`<span class="javascript">&lt;<span class="regexp">/pre&gt;

3rd, this is all tied together with a file called </span></span>`fig.yml`<span class="javascript">. It describes the services that our app comprises of (a web server and database), what Docker images they use, how they link together, what volumes will be mounted inside the containers and what ports they expose.

&lt;pre&gt;</span>`<span class="attribute">db</span>:  
  <span class="attribute">image</span>: dockerfile/mongodb
  <span class="attribute">command</span>: mongod --smallfiles  <span class="comment"># for fix this image's bug</span>

<span class="attribute">web</span>:  
  <span class="attribute">build</span>: .
  <span class="attribute">command</span>: node app.js
  <span class="attribute">volumes</span>:
    - ./app.<span class="attribute">js</span>:/data/app.js
  <span class="attribute">ports</span>:
    - <span class="string">"3000:3000"</span>
  <span class="attribute">links</span>:
    - db
  <span class="attribute">environment</span>: 
   <span class="attribute">MONGO_URL</span>: <span class="attribute">mongodb</span>:<span class="regexp">//</span>db
`<span class="javascript">&lt;<span class="regexp">/pre&gt;

See the [fig.yml reference](http:/</span><span class="regexp">/www.fig.sh/</span>yml.html) <span class="keyword">for</span> more information on how it works.

Finally, we need a file called <span class="string">'app.js'</span> to start the expressjs app and connect the mongodb.

&lt;pre&gt;</span>`<span class="reserved">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>),  
    mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>);

<span class="reserved">var</span> app = express(),  
    connected = <span class="literal">true</span>;

<span class="regexp">//</span> Test the mongodb connect <span class="keyword">is</span> ok
mongoose.connect(process.env.MONGO_URL , <span class="reserved">function</span>(err) {

    <span class="keyword">if</span> (err) {
        connected = <span class="literal">false</span>;
        <span class="built_in">console</span>.log(<span class="string">'Could not connect to MongoDB!'</span>);
        <span class="built_in">console</span>.log(err);
    }

});

<span class="regexp">//</span> Test the web server
app.get(<span class="string">'/'</span>, <span class="reserved">function</span> (req, res) {

    <span class="keyword">if</span> (connected) {
        res.send(<span class="string">'MongoDB has been connected.'</span>);
    } <span class="keyword">else</span> {
        res.send(<span class="string">'Could not connect to MongoDB!'</span>);
    }

});

<span class="reserved">var</span> server = app.listen(<span class="number">3000</span>, <span class="reserved">function</span> () {

    <span class="reserved">var</span> host = server.address().address,
        port = server.address().port;
    <span class="built_in">console</span>.log(<span class="string">'Example app listening at http://%s:%s'</span>, host, port);

});
`<span class="javascript">&lt;<span class="regexp">/pre&gt;

OK, everything has been ready.

Then, run </span></span>`fig up`<span class="javascript">:

<span class="xml"><span class="tag">&lt;<span class="title">pre</span>&gt;</span></span></span>`Recreating myapp_db_1...  
Recreating myapp_web_1...  
Attaching to myapp_db_1, myapp_web_1  
db_1  | <span class="number">2015</span>-<span class="number">02</span>-<span class="number">17</span><span class="attribute">T07</span>:<span class="number">16</span>:<span class="number">16.363</span>+<span class="number">0000</span> [initandlisten] waiting <span class="keyword">for</span> connections <span class="literal">on</span> port <span class="number">27017</span>  
...
web_1 | Example app listening at <span class="attribute">http</span>:<span class="regexp">//</span><span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:<span class="number">3000</span>
</code></pre><p>In the background: </p>
<p>1. Fig will help you to build a new image with your <code>Dockerfile</code>. </p>
<p>2. Fig create two container (web and db). </p>
<p>3. Run a command <code>node app.js</code> (configed in fig.yml) on the web container.</p>
<p>And now your Expressjs app should be running at port 3000 on your docker daemon (if you’re using boot2docker, <code>boot2docker ip</code> will tell you its address).</p>
<p>DONE</p>
<ul>
<li>all the code will be donwload on <a href="https://github.com/guolin/fig-expressjs-examples*" target="_blank" rel="external">https://github.com/guolin/fig-expressjs-examples*</a></li>
</ul>
<p><em>注：第一次写英文博客 :)</em></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://guolinn.com/2015/02/17/Getting-started-with-Fig-and-Express-js/" data-id="v5d99zhh331ksbpn" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/docker/">docker</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nodejs/">nodejs</a></li></ul>

    </footer>
  </div>
  
</article>


  
  
</section>
        
          <aside id="sidebar">
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Getting-Started/">Getting Started</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/">JavaScript</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/">docker</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/internet-of-things/">internet of things</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nodejs/">nodejs</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Getting-Started/" style="font-size: 10.00px;">Getting Started</a><a href="/tags/JavaScript/" style="font-size: 10.00px;">JavaScript</a><a href="/tags/docker/" style="font-size: 20.00px;">docker</a><a href="/tags/internet-of-things/" style="font-size: 10.00px;">internet of things</a><a href="/tags/nodejs/" style="font-size: 10.00px;">nodejs</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/02/">February 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/08/">August 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/07/">July 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/06/">June 2014</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/05/">May 2014</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2015/02/23/js-datastructure-lodash/">JavaScript 数据结构 与 lodash</a>
          </li>
        
          <li>
            <a href="/2015/02/23/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2015/02/17/Getting-started-with-Fig-and-Express-js/">Getting started with Fig and Express.js</a>
          </li>
        
          <li>
            <a href="/2015/02/17/Docker搭建Shadowsocks/">Docker搭建Shadowsocks</a>
          </li>
        
          <li>
            <a href="/2014/08/09/JavaScript-数据结构-与-lodash/">JavaScript 数据结构 与 lodash</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2015 GuoLin<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">

  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>



<script src="/js/script.js" type="text/javascript"></script>


  </div>
</body>
</html>